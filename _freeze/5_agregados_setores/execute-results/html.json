{
  "hash": "fcc49f807b3bc9e467e18f4b7e2cab45",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfrom: markdown+emoji\ncode-annotations: hover\n---\n\n\n\n\n# Agregados dos Setores Censitários\n\nTalvez os conjuntos de dados mais comumente usados dos censos brasileiros sejam os microdados de pessoas e domicílios. No entanto, o IBGE também disponibiliza dados muito ricos sobre as características populacionais e ambientais agregados no nível de setores censitários. Neste capítulo, mostramos como usar o pacote **{censobr}** para acessar facilmente esses dados usando a função `read_tracts()`.\n\nEsta função permite ler os dados agregados por setores censitários para os censos de 2000, 2010 e 2022.\n\n## Estrutura dos dados\n\nNo seu formato original, os dados agregados no nível de setores censitários estão divididos em diferentes tipos de variáveis (e.g. variáveis de características de pessoas, de domicílios, etc). Em muitos casos, esses conjuntos de variáveis estão espalhados por vários arquivos (em alguns casos com centenas variáveis). Para facilitar o entendimento desses dados, o **{censobr}** reúne todos os arquivos / variáveis diferente tabelas (datasets):\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; \">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> 2000 </th>\n   <th style=\"text-align:left;\"> 2010 </th>\n   <th style=\"text-align:left;\"> 2022 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Basico </td>\n   <td style=\"text-align:left;\"> Basico </td>\n   <td style=\"text-align:left;\"> Basico </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Domicilio </td>\n   <td style=\"text-align:left;\"> Domicilio </td>\n   <td style=\"text-align:left;\"> Domicilio </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Pessoa </td>\n   <td style=\"text-align:left;\"> Pessoa </td>\n   <td style=\"text-align:left;\"> Pessoas </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Responsavel </td>\n   <td style=\"text-align:left;\"> Responsavel </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Instrucao </td>\n   <td style=\"text-align:left;\"> Entorno </td>\n   <td style=\"text-align:left;\"> Entorno </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Morador </td>\n   <td style=\"text-align:left;\"> ResponsavelRenda </td>\n   <td style=\"text-align:left;\"> ResponsavelRenda </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> DomicilioRenda </td>\n   <td style=\"text-align:left;\"> Indigenas </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> PessoaRenda </td>\n   <td style=\"text-align:left;\"> Quilombolas </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Obitos </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Preliminares </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\nTodas estas tabelas estão organizadas seguindo a mesma lógica. Nos casos em que as variáveis de uma tabela provêm de arquivos diferentes, o nome da variável recebe um prefixo indicando a sua tabela de origem. Isso é feito para facilitar a consulta do significado de cada coluna no arquivo de dicionário variáveis (no próximo capítulo a gente vai ver como baixar os dicionários variáveis dos censos).\n\nPara ilustrar isso, vejamos a tabela com variáveis de `\"Domicilio\"` do censo de 2022. Essa tabela provêm de três arquivos separados: *Domicilio01*, *Domicilio02* e *Domicilio03*. Assim, os nomes das colunas nessa tabela são organizados da seguinte maneira:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndom <- censobr::read_tracts(\n  year = 2022,\n  dataset = 'Domicilio', \n  showProgress = FALSE\n  )\n\nnames(dom)[c(30:33,119:121, 526:528)]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"domicilio01_V00001\" \"domicilio01_V00002\" \"domicilio01_V00003\"\n [4] \"domicilio01_V00004\" \"domicilio02_V00090\" \"domicilio02_V00091\"\n [7] \"domicilio02_V00092\" \"domicilio03_V00497\" \"domicilio03_V00498\"\n[10] \"domicilio03_V00499\"\n```\n\n\n:::\n:::\n\n\n\n\n## Dicionário de variáveis\n\nPara verificar o significado de cada variável, você pode executar o comando `data_dictionary()`, que o arquivo com o dicionário de variáveis de cada conjunto de dados (ver mais info no capítulo 6 sobre Documentação).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncensobr::data_dictionary(\n  year = 2022,\n  dataset = 'tracts'\n  )\n```\n:::\n\n\n\n\n\n## Exemplos reproduzíveis\n\nEssa organização dos dados agregados por setores censitários parece confusa a primeira vista. E é mesmo. Mas essa organização fica mais clara com alguns exemplos práticos.\n\nNesta seção, nós vamos utilizar alguns exemplos para ilustrar como trabalhar com dados no nível de setor censitário. Primeiro, precisamos carregar as bibliotecas que usaremos neste tutorial.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(censobr)\nlibrary(geobr)\nlibrary(arrow)\nlibrary(dplyr)\nlibrary(ggplot2)\n```\n:::\n\n\n\n\nNos dois exemplos abaixo, usaremos a cidade de Belo Horizonte para fins de demonstração. No primeiro exemplo, nós vamos mapear a distribuição espacial da renda com dados de 2010. No segundo exemplo, nós vamos mapear a distribuição espacial da densidade populacional de BH com os dados preliminares do censo de 2022.\n\n\n### Exemplo 1: Distribuição espacial da renda em 2010\n\nNeste primeiro exemplo, criaremos um mapa da distribuição espacial da renda média per capita. A informação sobre o número total de residentes em cada setor censitário está disponível na tabela com conjunto de variáveis do bloco `\"Basico\"`, na variável `\"V002\"`. Já a informação sobre renda total do setor censiário pode ser encontradas na  tabela do bloco `\"DomicilioRenda\"`, na variável `\"V003\"`.\n\nUtilizando o código abaixo, podemos baixar os dados e calcular a renda per capita de todos os setores censitários no Brasil. Posteriormente nós vamos filtrar esses resultados para ficar apenas com os setores de BH.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# baixa os dados\ntract_basico <- read_tracts(\n  year = 2010,                    # <1>\n  dataset = \"Basico\",\n  showProgress = FALSE\n  )\n\ntract_income <- read_tracts(\n  year = 2010,                    # <2>   \n  dataset = \"DomicilioRenda\",\n  showProgress = FALSE\n  )     \n\n# selecionar conlunas\ntract_basico <- tract_basico |> select('code_tract','V002') # <3>\ntract_income <- tract_income |> select('code_tract','V003') # <3>\n\n# unir as tabelass\ntracts_df10 <- left_join(tract_basico, tract_income)        # <4>\n                \n\n# calcular a renda per capita\ntracts_df10 <- tracts_df10 |> \n                mutate(income_pc = V003 / V002) |>          # <5>\n                collect()                                   # <6>\n\nhead(tracts_df10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  code_tract       V002   V003 income_pc\n  <chr>           <dbl>  <dbl>     <dbl>\n1 110001505000001   956 522231      546.\n2 110001505000002   859 406191      473.\n3 110001505000003   661 241587      365.\n4 110001505000004   266  88502      333.\n5 110001505000005  1206 262860      218.\n6 110001505000006   816 262968      322.\n```\n\n\n:::\n:::\n\n\n\n1. Download de dados do bloco Basico\n2. Download de dados do bloco DomicilioRenda\n3. Seleciona apenas as variáveis que vamos utilizar\n4. Junta as duas variáveis num único data.frame\n5. Cacula renda per capita de cada setor censitário\n6. Extração dos resultados\n\nO próximo passo é baixar as geometrias dos setores censitários de BH em 2010 com a função `read_census_tract`, do pacote **{geobr}**. Aqui, nós passamos o parâmetro `code_tract = \"MG\"` baixar os todos os setores do estado de Minas Gerais e depois filtramos apenas o município de Belo Horizonte.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# busca qual o código do municipio de Belo Horizonte\nbh_info <- geobr::lookup_muni(name_muni = 'Belo Horizonte')\n#> code_muni: 3106200\n\n# baixa municipio de BH\nmuni_bh <- geobr::read_municipality(\n  code_muni = 'MG', \n  year = 2010,\n  showProgress = FALSE) |>\n  filter(name_muni == \"Belo Horizonte\")\n\n# baixa todos setores de Minas Gerais\ntracts_2010 <- geobr::read_census_tract(\n  code_tract = \"MG\",\n  year = 2010,\n  simplified = FALSE,\n  showProgress = FALSE) # <1>\n\n# filtra setores de BH\ntracts_2010 <- filter(tracts_2010, name_muni == 'Belo Horizonte')\n\n# mapa de setores censitarios\nggplot() + \n  geom_sf(data=tracts_2010, fill = 'gray90', color='gray60') +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](5_agregados_setores_files/figure-html/get-geobr-data-1.png){width=672}\n:::\n:::\n\n\n\n1. O comportamento padrão do `{geobr}` é baixar uma versão da malha espacial com geometrias ligeiramente simplificadas (`simplified = TRUE`) para agilizar o processamento e visualização de dados. Aqui, nós baixamos os dados com geometrias originais devido à escala espacial da visualização dos resultados.\n\n\nPor fim, a gente pode fazer um *merge* dos dados espaciais e de renda dos setores censitários usando como variável chave o código do setor censitário (`code_tract`) e criar o mapa da distribuição espacial da renda per capita do município.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbh_tracts <- left_join(tracts_2010, tracts_df10, by = 'code_tract')\n\nggplot() +\n  geom_sf(data = bh_tracts, aes(fill = ifelse(income_pc<10000,income_pc,10000)), \n          color=NA) +\n  geom_sf(data = muni_bh, color='gray10', fill=NA) +\n  labs(title = 'Renda per capita dos setores censitários',\n       subtitle= 'Belo Horizonte, 2010') +\n  scale_fill_viridis_c(name = \"Reda per\\ncapita (R$)\",\n                       na.value=\"white\",\n                       option = 'cividis',\n                       breaks = c(0,  1e3, 4e3, 8e3, 1e4) ,\n                        labels  = c('0',  '1.000', '4.000', '8.000', '> 10.000')\n                       ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](5_agregados_setores_files/figure-html/map-renda-setores-1.png){width=672}\n:::\n:::\n\n\n\n\n### Examplo 2: Distribuição espacial da população em 2022\n\nNeste segundo exemplo, nós vamos utilizar os resultados `\"Basico\"` dos agregados dos setores censitários do censo de 2022. Em particular, vamos utilizar a variável `V0001` que informa a população total dos setores. Além disso, como houve uma mudança na malha espacial de setores censitários entre 2010 e 2022, nós precisamos baixar a malha do ano correspondente.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# download dados preliminares dos setores de 2022\ntracts_df <- censobr::read_tracts(\n  year = 2022,\n  dataset = \"Basico\",\n  showProgress = FALSE) |>\n  filter(name_muni == 'Belo Horizonte') |>\n  collect()\n\n# baixa todos setores de Minas Gerais\ntracts_sf <- geobr::read_census_tract(\n  code_tract = \"MG\",\n  year = 2022,\n  simplified = FALSE,\n  showProgress = FALSE\n  )\n\n# filtra setores de BH\ntracts_sf <- filter(tracts_sf, name_muni == 'Belo Horizonte')\n```\n:::\n\n\n\n\nAgora a gente pode fazer um *merge* da tabela de população com os dados espaciais, calcular a área dos setores em Km<sup>2</sup> e a densidade demográfica de cada setor, e criar o mapa.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# merge tables\ntracts_sf$code_tract <- as.character(tracts_sf$code_tract)\nbh_tracts22 <- left_join(tracts_sf, tracts_df, by = 'code_tract')\n\n# calcula a área dos setores\nbh_tracts22 <- bh_tracts22 |>\n              mutate(tract_aream2 = sf::st_area(bh_tracts22),\n                     tract_areakm2 = units::set_units(tract_aream2, km2))\n\n# calcula densidade demografica\nbh_tracts22 <- bh_tracts22 |>\n               mutate(pop_km2 = as.numeric(V0001/ tract_areakm2))\n\n# map\nggplot() +\n  geom_sf(data = bh_tracts22, color=NA,\n          aes(fill = ifelse(pop_km2<20000,pop_km2,20000))) +\n  geom_sf(data = muni_bh, color='gray10', fill=NA) +\n  labs(title = 'Densidade populacional dos setores censitários',\n       subtitle= 'Belo Horizonte, 2022') +\n  scale_fill_distiller(palette = \"Reds\", direction = 1, \n                       name='População por'~Km^2,\n                       breaks = c(0,  5e3, 10e3, 15e3, 2e4) ,\n                       labels  = c('0',  '5.000', '10.000', '15.000', '> 20.000')) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](5_agregados_setores_files/figure-html/map-tracts-arborizacao-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "5_agregados_setores_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}